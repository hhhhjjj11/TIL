# 마이바티스 실습
## 1. java 프로젝트 하나만듬
<br>

## 2. 프레임워크 디펜던시 추가(jar파일 추가)
  - lib폴더 만들고 mysql이랑 mybatis추가하자
  - mvnrepository > mybatis검색 > 3.5.9버전 ㄱㄱ > jar파일 다운받자
 
[참고] 밑에 코드복사하는거는 pom.xml로 설정할때 쓰고 lib폴더에 jar파일 넣어서 쓸때는 jar파일 다운 받자

<br>

## 3. 등록해주기
- [참고] dynamic web project의 경우에는 jar파일을 넣어주면 자동으로 등록이 됐었지만,
java project의 경우에는 등록도 따로 해주어야함.
- 프로젝트 우클릭 > configure build path > Java Build Path > Addjars > 방금 넣은 jar파일 두개 (mysql이랑 mybatis) 등록 ㄱ
- Referenced Libraries에 등록 된것 확인

<br>

## 4. mybatis-config.xml 설정 작성
- 4.1 소스폴더 하나 만들자 (resources) > "config"패키지 만들고 > "mybatis-config"xml파일 생성ㄱ ㄱ
- 4.2 mybatis공식문서가서 > 시작하기 > xml코드 긁어서 복붙
- [설명] 윗부분코드 : 현재 xml파일이 my-batis설정을 하도록 연결설정
- 아래부분 : configuration

  ```xml
  <?xml version="1.0" encoding="UTF-8" ?>
  <!DOCTYPE configuration
    PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-config.dtd">
  <configuration>
  <!-- 여기서 가져와라잉 -->
  <properties resource="config/db.properties"></properties>
    <environments default="development">
      <environment id="development">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
          <property name="driver" value="${driver}"/>
          <property name="url" value="${url}"/>
          <property name="username" value="${username}"/>
          <property name="password" value="${password}"/>
        </dataSource>
      </environment>
    </environments>
    <mappers>
      <mapper resource="mapper/boardMapper.xml"/>
    </mappers>
  </configuration>
  ```
1. `<configuration>` 작성시 순서가 있음.(공식문서) 순서대로 작성해줘야함
2. `<environments>` : 환경, 여러개가 있을 수 있음.
 - 예를들어, 디비를 여러개를 연결해놓을 수 이씀
 - 개발용 테스트 디비와, 배포용 디비
3. `<mappers>` : sql을 경로를 적어줌으로써 sql을 매핑 해준다.

<br>

## 5. db.properties파일 만들어서 변수 따로 관리하기
  - 환경설정할건데, property 설정할때, 값 직접 넣지 않고, 다른 파일에다가 변수-값으로 저장해놓고 그거 불러다가 쓴다!!
   - resources >config > db.properties File(클래스아니고 File임) 생성 (.properties를 확장자로 가지는 db라는 이름의 파일)
   
 - 
    ```file
    url=jdbc:mysql://localhost:3306/ssafy_board?serverTimezone=UTC (DButil.java에서 긁어오면됨)
    driver=com.mysql.cj.jdbc.Driver
    username=ssafy
    password=ssafy
    ```

<br>

 ## 6. resources > mapper > boardMapper.xml 만든다.
- 다음. boardMapper.xml에 코드를 다음과 같이 넣는다. 
- 공식문서에서 긁어온것에 알맞은 dao경로를 넣어주면 됨.
- 
  ```xml
  <?xml version="1.0" encoding="UTF-8" ?>
  <!-- 매퍼파일임을 나타내주는 설정코드 -->
  <!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
  <!-- 어떤 dao와 매핑할것인지 경로를 넣어준다.. -->  
  <mapper namespace="com.ssafy.board.model.dao.BoardDao">
  </mapper>
  ```

<br>

## 7. dto랑 dao를 가져온다. (src/main/java/com.ssafy.board.model.dao)

<br>

## 8. sqlSession이용할건데, sqlSession을 조작하는 코드(만들고, 꺼내는 등)를 매번작성하기 보다는, 클래스 따로 만들어서 사용(MyAppSqlConfig) ㄱㄱ
### [개념] sqlSession
  - 마이바티스는 db에 쿼리날릴때 , sqlSession이용해서 날린다.
  - sqlSessionFactory로 sqlSession 만들어서 쓴다.
  - sqlSessionFactory는 이름에서 보듯 SqlSession인스턴스를 만들 수 있다 .
  - SqlSession은 db에 SQL문을 실행하기 위해 필요한 모든 메소드를 갖고 있다.

(1) com.ssafy.board.config > MyAppSqlConfig클래스 만들기

(2) 아래와 같이 코드작성

- ```java
  package com.ssafy.board.config;

  import java.io.IOException;
  import java.io.Reader;
  import java.sql.Connection;

  import org.apache.ibatis.io.Resources;
  import org.apache.ibatis.session.Configuration;
  import org.apache.ibatis.session.ExecutorType;
  import org.apache.ibatis.session.SqlSession;
  import org.apache.ibatis.session.SqlSessionFactory;
  import org.apache.ibatis.session.SqlSessionFactoryBuilder;
  import org.apache.ibatis.session.TransactionIsolationLevel;

  public class MyAppSqlConfig {
    private static SqlSession session;
    
    static {
      try {
        //MyBatis 설정파일을 가져오기
        
        // sqlsessionfactory 객체 만들기
        String resource = "config/mybatis-config.xml";
        Reader reader = Resources.getResourceAsReader(resource);
        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader); 
        
        // 팩토리 이용해서 세션인스턴스 ㄱㄱ
        session = sqlSessionFactory.openSession(true);
        System.out.println("세션 생성 성공");
      } catch (IOException e) {
        System.out.println("세션 생성 실패");
      }
      
    }
    
    public static SqlSession getSession() {
      return session;
    }
  }
  ```

## 9. 테스트 ㄱㄱ
- 위와같이 쭉 따라 왔으면 실행했을때 콘솔에 "세션 생성 성공"이 떠야 함.
  ```java
  package com.ssafy.board.test;

  import com.ssafy.board.config.MyAppSqlConfig;
  import com.ssafy.board.model.dao.BoardDao;

  public class Test {
    public static void main(String[] args) {
      // 이렇게 하면 마이바티스가 dao를 구현해서 구현체를 반환해줌. getMapper를 이용한다는 점.
      // 이렇게 하면 전에 했던 것 처럼 DaoImpl클래스를 따로 만들 필요가 없게됨.
      BoardDao dao = MyAppSqlConfig.getSession().getMapper(BoardDao.class);
    }
  }
  ```

## 여기까지하면.. Dao랑 mapper파일을 연동해서 DaoImpl을 만든것임!!