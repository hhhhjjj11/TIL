# 3월 21일

# 이미지(미디어파일) CRUD

## 1. CREATE : 사용자로부터 이미지 받아서 저장하기

## 요약 :

### media폴더 생성 -> settings.py 추가 -> project.urls에 + static~ -> 스키마, 이미지필드추가 -> 폼태그, enctype속성 추가 -> 미들웨어, req.FILES 넣어서 폼생성 하고 db저장 -> 템플릿, <'img src="{{article.image.url}}">

</br>

0. root > media 폴더 만들기 (이미지들이 저장될 폴더임)

1. settings.py에서

```python
# 1.사용자가 업로드한 파일을 저장하는 경로
MEDIA_ROOT = BASE_DIR / 'media'

# 2. URL 설정
MEDIA_URL = '/media/'
```

2. project > urls.py 에서

- 임포트 두줄
- pattherns에 + static 을 다음과 같이 해주기.

```python
# static 설정을 위한 import
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('articles/', include('articles.urls')),
] + static(settings.MEDIA_URL, document_root = settings.MEDIA_ROOT)
# 의미: 첫번째 인자가 요청주소이고 두번째 인자가 저장위치를 지정하는 것.
```

3. models.py 에서 모델클래스 하위에 이미지필드 추가

```python
class Article(models.Model):
    image = models.ImageField(blank=True)
    # blank = True : null값을 허용함
```

4. 이제, migrations 해주면 되는데 , 그전에 pillow 라이브러리 깔아줘야 이미지 마이그레이션 할 수 있음

```
$ pip install pillow
```

하고나서 마이그레이션 ㄱ

추가. 5. create.html에 폼태그에 enctype속성 추가해줘야함

```html
{% extends 'base.html' %}
{% block content %}
<h1>게시글 생성</h1>
</br>
<form action={% url 'articles:create' %} method = 'post' enctype="multipart/form-data">
    {% csrf_token %}
  {{form.as_p}}
    <input type="submit">
</form>
{% endblock content %}
```

- 인코딩타입을 위와같이 지정해 주지 않으면 이미지도 문자열로 인코딩됨
- 저렇게 속성을 넣어 줘야 이미지가 그대로 이미지로 남음. (이미지가 문자로 인코딩되는것을 막아주는 역할을 한다.)

- 그리고 인코딩 되지 않은 이미지 파일은 request.FILES에 들어온다!!!
  따라서

6. views.py에서

- articleForm에 두번째 인자로 req.FILES를 넣어서 form을 생성한다.

```python
def create(req):
    if req.method == "POST":
        form = ArticleModelForm(req.POST, req.FILES)
        if form.is_valid(): # 입력된 폼이 유효하다면
            article = form.save()
            return redirect('articles:detail', article.pk)
        return redirect('articles:create')
```

결과 :

- 이미지를 저장하면
- root > media에 이미지 파일이 저장이되고
- db에는 경로가 저장됨.

참고. 미디어폴더 하위에 폴더 또 만들어서 관리하기
-> model.py에서 모델 클래스에 로직추가 (upload_to 속성 추가)

```python
class Article(models.Model):
    image = models.ImageField(blank=True, upload_to='articles/%Y%m%d')
```

-> media > articles > 현재날짜및시간 으로된 폴더 하위에 저장됨. (폴더가 없다면 생성한뒤 그 안에 저장됨) 개뀰

</br></br>

## 2. READ : 상세페이지(또는목록)에 이미지 같이 띄워주기

- article.image.url 해줘야함. 뒤에 .url붙이기

```
<img src="{{article.image.url}}" alt="이미지가 없습니다">
```
